!function(e,n){"object"==typeof exports&&"object"==typeof module?module.exports=n():"function"==typeof define&&define.amd?define([],n):"object"==typeof exports?exports.LocalDB=n():e.LocalDB=n()}("undefined"!=typeof self?self:this,function(){return function(e){var n={};function r(t){if(n[t])return n[t].exports;var o=n[t]={i:t,l:!1,exports:{}};return e[t].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=e,r.c=n,r.d=function(e,n,t){r.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:t})},r.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(n,"a",n),n},r.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},r.p="",r(r.s=0)}([function(e,n,r){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var t=function(){function e(e,n){for(var r=0;r<n.length;r++){var t=n[r];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,t.key,t)}}return function(n,r,t){return r&&e(n.prototype,r),t&&e(n,t),n}}(),o=u(r(2)),i=u(r(3));function u(e){return e&&e.__esModule?e:{default:e}}var a=new WeakMap,c=new WeakMap,s=new WeakMap,f=window.indexedDB||window.webkitIndexedDB||window.mozIndexedDB||window.msIndexedDB,l=function(){function e(n,r){if(function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e),!f)throw new Error("IndexedDB is not supported in this environment. Check if you're in web browser which supports IndexedDB.");this.name=n,this.version=r,a.set(this,{}),c.set(this,null),s.set(this,{})}return t(e,null,[{key:"Query",get:function(){return i.default}}]),t(e,[{key:"schema",value:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=a.get(this);return r[e]=n,this}},{key:"build",value:function(){var e=this,n=a.get(this),r=s.get(this);return new Promise(function(t,i){var u=f.open(e.name,e.version);u.onerror=function(e){i(new Error("IndexedDB is not available: "+e.target.errorCode))},u.onupgradeneeded=function(t){var i=t.target.result,u=t.target.transaction,a=u.objectStoreNames;for(var s in n){var f=n[s].key||"id",l=null;try{l=u.objectStore(s)}catch(e){"NotFoundError"===e.name&&(l=i.createObjectStore(s,{keyPath:f}))}if(l){var d=l.indexNames,y=new o.default(i,s,f);if(n[s].index&&n[s].index.length>0)for(var v in n[s].index)if("string"==typeof n[s].index[v]){var b=n[s].index[v],p=!1;for(var h in d)if(d[h]===b){p=!0;break}p||l.createIndex(b,n[s].index[v],{unique:!1})}for(var m=0;m<d.length;m++)n[s].index&&n[s].index!==d[m]||l.deleteIndex(d[m]);r[s]=y}}for(var w=0;w<a.length;w++)Object.keys(n).indexOf(a.item(w))<0&&i.deleteObjectStore(a.item(w));c.set(e,i)},u.onsuccess=function(i){var u=i.target.result;for(var a in n)if(!r[a]){var s=n[a].key||"id";r[a]=new o.default(u,a,s)}c.set(e,u),t()}})}},{key:"close",value:function(){var e=c.get(this);e&&(e.close(),c.set(this,null))}},{key:"drop",value:function(){f.deleteDatabase(this.name)}},{key:"collection",value:function(e){var n=s.get(this);return n[e]&&n[e]instanceof o.default?n[e]:null}}]),e}();n.default=l},function(e,n,r){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};n.deepEqual=function e(n,r){var o=void 0===n?"undefined":t(n),i=void 0===r?"undefined":t(r);return!n||!r||"object"!==o||o!==i||n instanceof Date?n instanceof Date?n.getTime()===r.getTime():"function"===o&&"function"===i||n===r:Object.keys(n).length===Object.keys(r).length&&Object.keys(n).every(function(t){return e(n[t],r[t])})}},function(e,n,r){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=function(){function e(e,n){for(var r=0;r<n.length;r++){var t=n[r];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,t.key,t)}}return function(n,r,t){return r&&e(n.prototype,r),t&&e(n,t),n}}(),i=function(e){return e&&e.__esModule?e:{default:e}}(r(0)),u=r(1);var a=new WeakMap,c=function(){function e(n,r,t){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e),this.name=r,this.keyPath=t,a.set(this,n)}return o(e,[{key:"findById",value:function(e){var n=this,r=a.get(this);return new Promise(function(t,o){var i=r.transaction(n.name,"readonly").objectStore(n.name).get(e);i.onsuccess=function(){t(i.result||null)},i.onerror=function(){o(i.error)}})}},{key:"find",value:function(e){var n=this,r=a.get(this);return new Promise(function(t,o){if(e instanceof i.default.Query){var u=[],a=r.transaction(n.name,"readonly").objectStore(n.name),c=e.orderBy?a.index(e.orderBy).openCursor(null,e.desc?"prev":"next"):a.openCursor(),s=e.offset;c.onsuccess=function(n){var r=n.target.result;if(r)if(!s||s<0){var o=r.value;e.match(o)?(u.push(o),u.length<e.limit?r.continue():t(u)):r.continue()}else s--,r.continue();else t(u)},c.onerror=function(){o(c.error)}}else o(new Error("Invalid type: 'query' should be LocalDB.Query type."))})}},{key:"count",value:function(e){var n=this,r=a.get(this);return new Promise(function(t,o){if(!e||e instanceof i.default.Query){var u=r.transaction(n.name,"readonly").objectStore(n.name);if(e){var a=0,c=u.openCursor();c.onsuccess=function(){var n=event.target.result;n?(e.match(n.value)&&a++,n.continue()):t(a)},c.onerror=function(){o(c.error)}}else{var s=u.count();s.onsuccess=function(){t(s.result)},s.onerror=function(){o(s.error)}}}else o(new Error("Invalid type: 'query' should be LocalDB.Query type."))})}},{key:"insert",value:function(e){var n=this,r=a.get(this);return new Promise(function(o,i){var u=r.transaction(n.name,"readwrite").objectStore(n.name);if(Array.isArray(e))!function(){var n=[],r=function(r){var t=e[r],a=u.add(t);a.onsuccess=function(){n.push(t),n.length===e.length&&o(n)},a.onerror=function(){i(a.error)}};for(var t in e)r(t)}();else if(e&&"object"===(void 0===e?"undefined":t(e))){var a=u.add(e);a.onsuccess=function(){o(e)},a.onerror=function(){i(a.error)}}else i(new Error("Invalid type: 'item' should be an object or an object array."))})}},{key:"upsert",value:function(e){var n=this,r=a.get(this);return new Promise(function(o,i){var u=r.transaction(n.name,"readwrite").objectStore(n.name);if(e&&"object"===(void 0===e?"undefined":t(e))){var a=u.get(e[n.keyPath]);a.onsuccess=function(){if(a.result){var n=u.put(e);n.onsuccess=function(){return o(e)},n.onerror=function(){return i(n.error)}}else{var r=u.add(e);r.onsuccess=function(){return o(e)},r.onerror=function(){return i(r.error)}}},a.onerror=function(){i(a.error)}}else i(new Error("Invalid type: 'item' should be an object or an object array."))})}},{key:"update",value:function(e){var n=this,r=a.get(this);return new Promise(function(t,o){var i=r.transaction(n.name,"readwrite").objectStore(n.name).put(e);i.onsuccess=function(){t(e)},i.onerror=function(){o(i.error)}})}},{key:"updateIf",value:function(e,n){var r=this,t=a.get(this);return new Promise(function(o,a){if(e instanceof i.default.Query){var c=[],s=t.transaction(r.name,"readwrite").objectStore(r.name),f=s.openCursor();f.onsuccess=function(r){var t=r.target.result;if(t){var i=t.value;if(e.match(i)){var f=!1;for(var l in n){var d=n[l];(0,u.deepEqual)(i[l],d)||(f=!0,i[l]=d)}if(f){var y=s.put(i);y.onsuccess=function(){c.push(i),t.continue()},y.onerror=function(){a(y.error)}}else t.continue()}else t.continue()}else o(c)},f.onerror=function(){a(f.error)}}else a(new Error("Invalid type: 'query' should be LocalDB.Query type."))})}},{key:"remove",value:function(e){var n=this,r=a.get(this);return new Promise(function(t,o){var i=r.transaction(n.name,"readwrite").objectStore(n.name).delete(e);i.onsuccess=function(){t()},i.onerror=function(){o(i.error)}})}},{key:"removeIf",value:function(e){var n=this,r=a.get(this);return new Promise(function(t,o){if(e instanceof i.default.Query){var u=[],a=r.transaction(n.name,"readwrite").objectStore(n.name),c=a.openCursor();c.onsuccess=function(){var r=event.target.result;if(r){var i=r.value;if(e.match(i)){var c=a.delete(i[n.keyPath]);c.onsuccess=function(){u.push(i),r.continue()},c.onerror=function(){o(c.error)}}else r.continue()}else t(u)},c.onerror=function(){o(c.error)}}else o(new Error("Invalid type: 'query' should be LocalDB.Query type."))})}},{key:"clear",value:function(){var e=this,n=a.get(this);return new Promise(function(r,t){var o=n.transaction(e.name,"readwrite").objectStore(e.name).clear();o.onsuccess=function(){r()},o.onerror=function(){t(o.error)}})}}]),e}();n.default=c},function(e,n,r){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var t=function(){function e(e,n){for(var r=0;r<n.length;r++){var t=n[r];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,t.key,t)}}return function(n,r,t){return r&&e(n.prototype,r),t&&e(n,t),n}}(),o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=r(1);var u=1/0,a=function(){function e(n){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e),this.condition=n,this.offset=0,this.limit=u,this.orderBy=null,this.desc=!1}return t(e,null,[{key:"and",value:function(){for(var n=arguments.length,r=Array(n),t=0;t<n;t++)r[t]=arguments[t];return r.length>0?new e({"/and":r}):new e({})}},{key:"or",value:function(){for(var n=arguments.length,r=Array(n),t=0;t<n;t++)r[t]=arguments[t];return r.length>0?new e({"/or":r}):new e({})}}]),t(e,[{key:"match",value:function(e){return function e(n,r){var t=!0;for(var u in r){switch(u){case"/and":t=t&&r[u].reduce(function(r,t){return t&&e(n,r)});break;case"/or":t=t&&r[u].reduce(function(r,t){return t||e(n,r)});break;default:var a=r[u];if("object"===(void 0===a?"undefined":o(a)))for(var c in a)switch(c){case">":t=t&&n[u]>a[c];break;case">=":t=t&&n[u]>=a[c];break;case"<":t=t&&n[u]<a[c];break;case"<=":t=t&&n[u]<=a[c];break;case"=":t=t&&n[u]===a[c];break;case"!=":t=t&&n[u]!==a[c];break;case"/in":t=t&&Array.isArray(a[c])&&a[c].indexOf(n[u])>=0;break;case"/nin":t=t&&Array.isArray(a[c])&&a[c].indexOf(n[u])<0;break;case"/like":t=t&&"string"==typeof a[c]&&"string"==typeof n[u]&&n[u].indexOf(a[c])>=0;break;case"/regex":t=t&&a[c]instanceof RegExp&&a[c].test(n[u]);break;case"/where":t=t&&a[c](n[u]);break;default:t=t&&(0,i.deepEqual)(n[u],a)}else t=t&&n[u]===a}if(!t)break}return t}(e,this.condition)}}]),e}();n.default=a}]).default});